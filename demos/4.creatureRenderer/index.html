<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    <canvas id="main" width="150" height="150"></canvas>

    <script src="jsbezier.js"></script>
    <script>
        var canvas = document.querySelector('#main');
        var ctx = canvas.getContext('2d');

        var mouse = {x: 0, y: 0};

        document.addEventListener('mousemove', function(e){
            mouse.x = e.clientX || e.pageX;
            mouse.y = e.clientY || e.pageY

            drawHead();
        }, false);

        function getAngle (p1, p2) {
            return  Math.atan2(p2.y - p1.y, p2.x - p1.x);
        }

        function point (p) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI, false);
            ctx.fillStyle = 'red';
            ctx.fill();
        }
        function debugBezier (bezier) {
            ctx.beginPath();
            point(bezier[0]);
            ctx.lineTo(bezier[1].x, bezier[1].y);
            point(bezier[1]);

            ctx.moveTo(bezier[3].x, bezier[3].y);
            point(bezier[3]);
            ctx.lineTo(bezier[2].x, bezier[2].y);
            point(bezier[2]);

            ctx.fillStyle = 'red';
            ctx.fill();
        }

        function bezier (bezier) {
            ctx.moveTo(bezier[0].x, bezier[0].y);
            ctx.bezierCurveTo(bezier[1].x, bezier[1].y, bezier[2].x, bezier[2].y, bezier[3].x, bezier[3].y);
        }

        function drawHead() {
            ctx.clearRect (0, 0, 150, 150);

            var bezier1 = [];
            bezier1[0] = {x: 80, y: 30 };
            bezier1[3] = {x: 80, y: 110 };
            bezier1[1] = {x: bezier1[0].x + 70, y: bezier1[0].y - 5};
            bezier1[2] = {x: bezier1[3].x + 65, y: bezier1[3].y - 3};

            var bezier2 = [];
            bezier2[0] = bezier1[3];
            bezier2[3] = bezier1[0];
            bezier2[1] = {x: bezier2[0].x - 70, y: bezier2[0].y + 2};
            bezier2[2] = {x: bezier2[3].x - 65, y: bezier2[3].y + 3};

            ctx.beginPath();
            bezier(bezier1);
            bezier(bezier2);
            ctx.stroke();

            var earStart = jsBezier.pointOnCurve(bezier2, 0.42);
            var earEnd = jsBezier.pointOnCurve(bezier2, 0.11);
            drawEar(earStart, earEnd);

            var eyeCenter = {x: earStart.x + 32, y: earStart.y + 2};
            drawEye(eyeCenter);

            earStart = jsBezier.pointOnCurve(bezier1, 1 - 0.21);
            earEnd = jsBezier.pointOnCurve(bezier1, 1 - 0.08);
            drawEar(earStart, earEnd, 'right');

            eyeCenter = {x: earStart.x - 8, y: earStart.y + 22};
            drawEye(eyeCenter);

            drawMouth(bezier1[3]);

        }

        function drawEar(earStart, earEnd, direction) {
            var earSize = 2;

            var bezier1 = [];
            bezier1[0] = earStart;
            bezier1[3] = {x: earStart.x + ((earEnd.x - earStart.x) / 2), y: earEnd.y - 20};
            bezier1[1] = bezier1[0];
            if (direction) {
                bezier1[2] = {x: bezier1[3].x + 5, y: bezier1[3].y};
            } else {
                bezier1[2] = {x: bezier1[3].x - 5, y: bezier1[3].y};
            }

            var bezier2 = [];
            bezier2[0] = bezier1[3];
            bezier2[3] = earEnd;
            bezier2[1] = {x: bezier2[0].x + 2, y: bezier2[0].y};
            bezier2[2] = bezier1[3];

            ctx.beginPath();
            bezier(bezier1);
            bezier(bezier2);
            ctx.stroke();
        }

        function drawEye(eyeCenter) {
            ctx.beginPath();
            ctx.arc(eyeCenter.x, eyeCenter.y, 15, 0, 2 * Math.PI, false);
            ctx.stroke();

            var angle = getAngle(eyeCenter, mouse);
            var radius = 7;
            var eyeball = {x: eyeCenter.x + radius * Math.cos(angle), y: eyeCenter.y + radius * Math.sin(angle)};

            ctx.beginPath();
            ctx.arc(eyeball.x, eyeball.y, 8, 0, 2 * Math.PI, false);
            ctx.fill();


        }

        function drawMouth(center) {
            var bezier1 = [];
            bezier1[0] = {x: center.x - 3, y: center.y - 17};
            bezier1[3] = {x: center.x + 7, y: center.y - 17};
            bezier1[1] = {x: bezier1[0].x, y: bezier1[0].y + 5};
            bezier1[2] = {x: bezier1[0].x + 3, y: bezier1[0].y};

            var bezier2 = [];
            bezier2[0] = bezier1[3];
            bezier2[3] = {x: bezier1[3].x + 7, y: bezier1[3].y};
            bezier2[1] = {x: bezier2[3].x - 5, y: bezier2[0].y};
            bezier2[2] = {x: bezier2[3].x, y: bezier2[3].y + 5};

            ctx.beginPath();
            bezier(bezier1);
            bezier(bezier2);
            ctx.stroke();
        }

        drawHead();



    </script>
</body>
</html>
